<head>
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>

  <script>
    window.onload = function () {
      const player = document.getElementById('player');
      const canvas = document.getElementById('canvas');
      const context = canvas.getContext('2d');
      const captureButton = document.getElementById('capture');

      const constraints = {
        video: true,
      };

      captureButton.addEventListener('click', () => {
        // Draw the video frame to the canvas.
        vid_size = find_video_size()
        canvas.width = vid_size[1]
        canvas.height = vid_size[0]
        context.drawImage(player, 0, 0, canvas.width, canvas.height);

        // Save image to filesystem
        var image = canvas.toDataURL()
        // window.location.href = image;
        var formCanvas = document.getElementById('canvas_datauri')
        formCanvas.value = image

      });

      // Attach the video stream to the video element and autoplay.
      navigator.mediaDevices.getUserMedia(constraints).then((stream) => {
        player.srcObject = stream;
      });

      function find_video_size() {
        // console.log(player.videoHeight + ' ' + player.videoWidth)
        return [player.videoHeight, player.videoWidth]
      }
    }


  </script>

</head>


<body>

  <center>
    <div class="container">
      <div class="jumbotron jumbotron-fluid">
        <h1>Take a snap</h1>
      </div>


      <video id="player" autoplay></video>
      <div style="padding: 1%;">
        <button class="btn btn-primary" id="capture">Capture/Retake Image</button>
      </div>

      {% if content %}
      <div class="alert alert-success">
        {{content['message']}}
      </div>
      {% endif %}

      <form action="" method="post">
        <canvas id="canvas"></canvas>
        <input type="text" id="canvas_datauri" name="canvas_datauri" hidden>
        <div class="center">
          <button type="submit" class="btn btn-success">Upload File</button>
        </div>
      </form>

    </div>
  </center>
</body>